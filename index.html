<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TaskPop</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#007AFF', // System Blue
                        secondary: '#8E8E93',
                        background: '#F2F2F7', // System Gray 6
                        card: 'rgba(255, 255, 255, 0.8)',
                    },
                    fontFamily: {
                        sans: ['-apple-system', 'BlinkMacSystemFont', 'Segoe UI', 'Roboto', 'Helvetica', 'Arial', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <!-- MapLibre GL JS -->
    <script src="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.js"></script>
    <link href="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.css" rel="stylesheet" />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="styles/main.css">

    <!-- Firebase SDKs (Modular) -->
    <!-- We will use ES modules in our JS files, so we import them there or use import map if needed. 
         For simplicity with vanilla JS without bundler, we might use script type="module" -->
</head>

<body class="bg-background text-gray-900 overflow-hidden h-screen w-screen selection:bg-primary selection:text-white">

    <!-- Loading Screen -->
    <div id="loading-screen"
        class="fixed inset-0 z-50 flex items-center justify-center bg-white transition-opacity duration-500">
        <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary"></div>
    </div>

    <!-- Auth Page -->
    <div id="auth-page" class="hidden fixed inset-0 z-40 flex flex-col items-center justify-center p-6 bg-background">
        <div class="w-full max-w-md bg-white/80 backdrop-blur-xl rounded-2xl shadow-xl p-8 border border-white/20">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-primary mb-2">TaskPop</h1>
                <p class="text-secondary">Connect with neighbors. Get things done.</p>
            </div>

            <!-- Login Form -->
            <form id="login-form" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                    <input type="email" id="login-email"
                        class="w-full px-4 py-3 rounded-xl bg-gray-100 border-transparent focus:bg-white focus:ring-2 focus:ring-primary focus:outline-none transition-all"
                        placeholder="hello@example.com" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                    <input type="password" id="login-password"
                        class="w-full px-4 py-3 rounded-xl bg-gray-100 border-transparent focus:bg-white focus:ring-2 focus:ring-primary focus:outline-none transition-all"
                        placeholder="••••••••" required>
                </div>
                <button type="submit"
                    class="w-full py-3 bg-primary text-white font-semibold rounded-xl shadow-lg hover:shadow-primary/30 transform active:scale-95 transition-all">Sign
                    In</button>
            </form>

            <!-- Signup Form (Hidden initially) -->
            <form id="signup-form" class="hidden space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Name</label>
                    <input type="text" id="signup-name"
                        class="w-full px-4 py-3 rounded-xl bg-gray-100 border-transparent focus:bg-white focus:ring-2 focus:ring-primary focus:outline-none transition-all"
                        placeholder="Your Name" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                    <input type="email" id="signup-email"
                        class="w-full px-4 py-3 rounded-xl bg-gray-100 border-transparent focus:bg-white focus:ring-2 focus:ring-primary focus:outline-none transition-all"
                        placeholder="hello@example.com" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                    <input type="password" id="signup-password"
                        class="w-full px-4 py-3 rounded-xl bg-gray-100 border-transparent focus:bg-white focus:ring-2 focus:ring-primary focus:outline-none transition-all"
                        placeholder="••••••••" required>
                </div>
                <button type="submit"
                    class="w-full py-3 bg-primary text-white font-semibold rounded-xl shadow-lg hover:shadow-primary/30 transform active:scale-95 transition-all">Create
                    Account</button>
            </form>

            <div class="mt-6 text-center">
                <button id="toggle-auth" class="text-sm text-primary font-medium hover:underline">New to TaskPop? Sign
                    Up</button>
            </div>
            <div id="auth-error" class="mt-4 text-center text-red-500 text-sm hidden"></div>
        </div>
    </div>

    <!-- My Tasks Page -->
    <div id="my-tasks-page"
        class="hidden fixed inset-0 z-0 bg-background flex flex-col pt-4 pb-24 px-4 overflow-y-auto">
        <h1 class="text-3xl font-bold mb-6 mt-8 px-2">My Tasks</h1>

        <div class="flex gap-4 mb-6 px-2">
            <button id="tab-posted"
                class="flex-1 py-2 bg-white rounded-lg shadow-sm font-medium text-primary border border-primary">Posted</button>
            <button id="tab-claimed"
                class="flex-1 py-2 bg-white/50 rounded-lg shadow-sm font-medium text-gray-500 border border-transparent">Claimed</button>
        </div>

        <div id="my-tasks-list" class="space-y-4">
            <!-- Task Items injected here -->
            <div class="text-center text-gray-400 mt-10">No tasks found.</div>
        </div>
    </div>

    <!-- App Page (Map & Interface) -->
    <div id="app-page-map" class="fixed inset-0 z-0">
        <!-- Map Container -->
        <div id="map" class="absolute inset-0 w-full h-full"></div>

        <!-- Header / Search -->
        <div class="absolute top-4 left-4 right-4 z-10 flex gap-3 pointer-events-none">
            <div
                class="flex-1 bg-white/80 backdrop-blur-md rounded-2xl shadow-lg border border-white/20 pointer-events-auto flex items-center px-4 py-3">
                <svg class="w-5 h-5 text-gray-400 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                </svg>
                <input type="text" id="search-input" placeholder="Search tasks..."
                    class="bg-transparent border-none focus:ring-0 w-full text-gray-800 placeholder-gray-500">
            </div>
            <button id="profile-btn"
                class="w-12 h-12 bg-white/80 backdrop-blur-md rounded-2xl shadow-lg border border-white/20 pointer-events-auto flex items-center justify-center overflow-hidden">
                <div id="user-avatar"
                    class="w-full h-full bg-gray-200 flex items-center justify-center text-gray-500 font-bold">U</div>
            </button>
        </div>

        <!-- Filter Bar -->
        <div class="absolute top-20 left-4 right-4 z-10 overflow-x-auto pb-2 pointer-events-none">
            <div class="flex gap-2 pointer-events-auto" id="filter-container">
                <button data-filter="all"
                    class="filter-chip active bg-primary text-white px-4 py-2 rounded-full shadow-md text-sm font-medium transition-all">All</button>
                <button data-filter="Help"
                    class="filter-chip bg-white/80 backdrop-blur-md text-gray-700 px-4 py-2 rounded-full shadow-sm text-sm font-medium hover:bg-white transition-all">Help</button>
                <button data-filter="Delivery"
                    class="filter-chip bg-white/80 backdrop-blur-md text-gray-700 px-4 py-2 rounded-full shadow-sm text-sm font-medium hover:bg-white transition-all">Delivery</button>
                <button data-filter="Social"
                    class="filter-chip bg-white/80 backdrop-blur-md text-gray-700 px-4 py-2 rounded-full shadow-sm text-sm font-medium hover:bg-white transition-all">Social</button>
            </div>
        </div>

        <!-- FAB (Add Task) -->
        <button id="fab-add-task"
            class="absolute bottom-24 right-6 z-20 w-14 h-14 bg-primary text-white rounded-full shadow-lg shadow-primary/40 flex items-center justify-center transform transition-transform hover:scale-110 active:scale-95">
            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6">
                </path>
            </svg>
        </button>
    </div>

    <!-- Bottom Navigation -->
    <div class="fixed bottom-6 left-6 right-6 z-20">
        <div class="bg-white/80 backdrop-blur-xl rounded-2xl shadow-lg border border-white/20 flex justify-around p-3">
            <button id="nav-explore"
                class="nav-item active text-primary flex flex-col items-center gap-1 transition-colors">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z">
                    </path>
                </svg>
                <span class="text-[10px] font-medium">Explore</span>
            </button>
            <button id="nav-mytasks" class="nav-item text-gray-400 flex flex-col items-center gap-1 transition-colors">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01">
                    </path>
                </svg>
                <span class="text-[10px] font-medium">My Tasks</span>
            </button>
            <button id="logout-btn" class="nav-item text-gray-400 flex flex-col items-center gap-1 transition-colors">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1">
                    </path>
                </svg>
                <span class="text-[10px] font-medium">Logout</span>
            </button>
        </div>
    </div>

    <!-- Create Task Modal -->
    <div id="create-modal" class="hidden fixed inset-0 z-30 pointer-events-none">
        <div class="absolute inset-0 bg-black/20 backdrop-blur-sm transition-opacity opacity-0 pointer-events-auto"
            id="create-modal-backdrop"></div>
        <div class="absolute bottom-0 left-0 right-0 bg-white rounded-t-3xl p-6 shadow-2xl transform translate-y-full transition-transform duration-300 pointer-events-auto"
            id="create-modal-content">
            <div class="w-12 h-1 bg-gray-300 rounded-full mx-auto mb-6"></div>
            <h2 class="text-xl font-bold mb-4">Post a Task</h2>
            <form id="create-task-form" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Title</label>
                    <input type="text" id="task-title"
                        class="w-full px-4 py-3 rounded-xl bg-gray-100 border-transparent focus:bg-white focus:ring-2 focus:ring-primary focus:outline-none"
                        placeholder="e.g. Move a couch" required>
                </div>
                <div class="flex gap-4">
                    <div class="flex-1">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Category</label>
                        <select id="task-category"
                            class="w-full px-4 py-3 rounded-xl bg-gray-100 border-transparent focus:bg-white focus:ring-2 focus:ring-primary focus:outline-none">
                            <option value="Help">Help</option>
                            <option value="Delivery">Delivery</option>
                            <option value="Social">Social</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="flex-1">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Reward (£)</label>
                        <input type="number" id="task-reward"
                            class="w-full px-4 py-3 rounded-xl bg-gray-100 border-transparent focus:bg-white focus:ring-2 focus:ring-primary focus:outline-none"
                            placeholder="15">
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                    <textarea id="task-desc" rows="3"
                        class="w-full px-4 py-3 rounded-xl bg-gray-100 border-transparent focus:bg-white focus:ring-2 focus:ring-primary focus:outline-none"
                        placeholder="Describe what you need..." required></textarea>
                </div>
                <div class="pt-2 flex gap-3">
                    <button type="button" id="cancel-create"
                        class="flex-1 py-3 bg-gray-100 text-gray-700 font-semibold rounded-xl">Cancel</button>
                    <button type="submit"
                        class="flex-1 py-3 bg-primary text-white font-semibold rounded-xl shadow-lg shadow-primary/30">Post
                        Task</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Task Details Modal (Similar to Create, but for viewing) -->
    <div id="task-detail-modal" class="hidden fixed inset-0 z-30 pointer-events-none">
        <div class="absolute inset-0 bg-black/20 backdrop-blur-sm pointer-events-auto" id="detail-modal-backdrop"></div>
        <div class="absolute bottom-0 left-0 right-0 bg-white rounded-t-3xl p-6 shadow-2xl transform translate-y-full transition-transform duration-300 pointer-events-auto"
            id="detail-modal-content">
            <div class="w-12 h-1 bg-gray-300 rounded-full mx-auto mb-6"></div>

            <div class="flex items-center gap-4 mb-6">
                <div id="detail-avatar"
                    class="w-12 h-12 rounded-full bg-gray-200 flex items-center justify-center font-bold text-gray-500">
                    U</div>
                <div>
                    <h3 id="detail-poster-name" class="font-bold text-lg">Poster Name</h3>
                    <p id="detail-time-dist" class="text-sm text-gray-500">2 min ago • 0.5 km away</p>
                </div>
                <div class="ml-auto">
                    <span id="detail-price"
                        class="bg-green-100 text-green-700 px-3 py-1 rounded-full font-bold">£15</span>
                </div>
            </div>

            <h2 id="detail-title" class="text-2xl font-bold mb-2">Task Title</h2>
            <p id="detail-desc" class="text-gray-600 mb-6 leading-relaxed">Description goes here...</p>

            <button id="claim-btn"
                class="w-full py-4 bg-primary text-white font-bold text-lg rounded-xl shadow-xl shadow-primary/30 hover:scale-[1.02] transition-transform">
                I'll do it!
            </button>
            <button id="delete-btn"
                class="hidden w-full py-4 bg-red-500 text-white font-bold text-lg rounded-xl shadow-xl shadow-red-500/30">
                Delete Task
            </button>
        </div>
    </div>

    <!-- Scripts -->
    <script type="module" src="js/firebase-config.js"></script>
    <script type="module" src="js/auth.js"></script>
    <!-- Map and Tasks will need to wait for Auth, so we might orchestrate in app.js -->
    <script type="module" src="js/map.js"></script>
    <script type="module" src="js/tasks.js"></script>
    <script type="module" src="js/app.js"></script>
</body>

</html>